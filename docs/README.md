[TOC]

# Agent

我认为可以分为三层, 执行目标+触发时机+执行指令

暂时可以简单的去构思而非复杂(缩略掉: 执行目标: 类型+连接信息; 触发时机: 针对实际环境动态调整触发时机; 执行指令: 执行目标内部的语言)

执行目标: 主机, ip、端口、用户名、密码，然后针对主机进行打标签, 相当于用户和角色, 一个用户在多个角色中

触发时机: 类似于crontab/quartz-trigger, 默认now(立即触发)

执行指令: python2/python3/shell/powershell等语言

# 一些问题

## 如何使用

选择一台主机(lable:1)进行在线使用(生成执行目标文件)

将参数抽取到数据参数中, 将数据与指令进行分离(生成执行参数文件、指令模板)

以一台主机进行测试, 执行时回显执行结果, 测试完成一台主机后即可作为多台主机的实施内容, 汇聚成单台的执行结果和报告, 以及多台结果中单台的执行状态表, 差异化对比多台的日志/状态以及单台历史状态对比(生成执行结果文件)

执行时每个业务有自己的局部数据文件夹, 每次执行都是一次新的文件夹(基于上一次), 对文件夹进行声明为只读(父文件夹), 读写共享(数据卷)

## 如何重用他人的指令

暂时可以通过github开源仓库进行共享, 可以命名问laashub-soa-<指令所在的自定义业务名称>

后续支持上传到统一的lasshub-soa-distribution库, 基于oss(文件分发)存储, 用户名+密码登录, 在线查看指令, 一键拉取指令

## 服务端如何连接

1、通过本机运行指令 agent test.service

2、通过http调用、mq增加记录等方式进行调用, 在启动agent时设置服务端参数/认证参数

## 服务端有哪些可以使用的方式

web界面

本地命令行

## 数据如何分发

server分发、P2P分发、agent拉取

## 如何初始化agent

通过分发ssh命令并执行并收集状态和日志, 反复重试, 告警

## agent如何保活

server定时检测、启动

agent守护进程

## agent如何开发

使用golang语言开发

使用github action触发构建文件并上传到github

源码分支管理模式基于main(开发分支)+tag(版本发布分支)+branch(多版本并行开发分支)